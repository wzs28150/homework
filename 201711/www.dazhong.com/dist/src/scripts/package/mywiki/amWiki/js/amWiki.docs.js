!function(e,t,n){"use strict";var o=e.hljs,r=e.marked,i="AMWikiUrlEncode",a=function(){this.$e={win:n(e),view:n("#view"),title:n("title"),contentsTitle:n("#contentsTitle")},this.data={pageWidth:0},this._initUrlEncode(),this._initHashEvent()};return a.prototype._initUrlEncode=function(){localStorage[i]?"utf8"!=localStorage[i]&&"gbk"!=localStorage[i]&&(localStorage[i]="utf8"):localStorage[i]="utf8",delete localStorage.urlEcode},a.prototype._initHashEvent=function(){var e=this;this.data.pageWidth=this.$e.win.width(),this.$e.win.on("resize",function(){e.data.pageWidth=e.$e.win.width()}),this.$e.win.on("hashchange",function(t){var o=location.hash.split("#")[1];e.data.pageWidth<=720&&e.$e.view.find("h1,h2,h3").each(function(t,r){var i=n(r),a=i.text().replace(/\s+/g,"");o==a&&e.$e.win.scrollTop(i.offset().top-55)})})},a.prototype._tramsformLinkText=function(e){return e.replace(/^\s+|\s+$/g,"").replace(/'/g,"&#39;").replace(/"/g,"&#34;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")},a.prototype._setTitlesAnchor=function(){var e=this,t=null,o="",r="";location.hash&&location.hash.length>1&&(o=location.hash.split("#")[1]);var i='<a class="anchor" href="#{title}" name="{title}"><svg><use xlink:href="#icon:linkAnchor"></use></svg></a>';return t=e.$e.view.find("h1,h2,h3"),t.each(function(t,a){var c=n(a),l=e._tramsformLinkText(c.text()),s=l.replace(/&#34;/g,"");c.is("h2")?r+="1. ["+l+"](#"+s+' "'+s+'")\n':c.is("h3")&&(r+="\t1. ["+l+"](#"+s+' "'+s+'")\n'),c.prepend(i.replace(/{title}/g,s)),o==c.text().replace(/"/g,"")&&(e.data.pageWidth<=720?e.$e.win.scrollTop(c.offset().top-55):e.$e.win.scrollTop(c.offset().top))}),0==r.indexOf("\t")&&(r="1. &#12288;\n"+r),r},a.prototype._setFootnote=function(e){var t=[],o=/\[\^([ a-zA-Z\d]+)]/g,r=/\[\^([ a-zA-Z\d]+)]: ?([\S\s]+?)(?=\[\^(?:[ a-zA-Z\d]+)]|\n\n|$)/g,i=n.trim(n("#template\\:footnote").text()).split(/[\r\n]+\s*/g);i[4]+=i[5]+i[6]+i[7]+i[8];var a="";if(e=e.replace(r,function(e,n,o,r){var i="";return o=o.replace(/"(.*?)"\s*$/,function(e,t){return i=t,""}),t.push({index:r,note:n,content:o,title:i,used:!1}),""}),e=e.replace(o,function(e,n){for(var o,r=0;o=t[r];r++)if(o.note==n)return o.used=!0,i[0].replace(/{{index}}/g,r+1+"").replace("{{title}}",o.title);var a=t.push({index:0,note:n,content:n,used:!0});return i[0].replace(/{{index}}/g,a+"")}),t.length>=1){for(var c,l=0;c=t[l];l++)a+=c.used?i[2].replace("{{index}}",l+1).replace("{{content}}",c.content).replace("{{back}}",i[4].replace("{{index}}",l+1)):i[3].replace("{{content}}",c.content);a=i[1].replace("{{list}}",a)}return e+"\n<br>"+a},a.prototype._setJSCommentDisable=function(e){var t=n('<div class="lang-off-js-comment">注<i>/</i></div>');t.on("click",function(){var t=n(this);t.hasClass("on")?(t.removeClass("on"),e.find(".hljs-comment").show()):(t.addClass("on"),e.find(".hljs-comment").hide())}),e.prepend(t)},a.prototype._createFlowChart=function(e){var t=e.text();e.text("");var n="flowChart"+parseInt(500*Math.random());e.attr("id",n);var o=flowchart.parse(t);o.drawSVG(n,{"line-width":1.3,"line-length":56,"line-color":"#666","text-margin":10,"font-size":12,font:"normal","font-family":"Helvetica","font-weight":"normal","font-color":"black","element-color":"#888",fill:"#fff","yes-text":"是","no-text":"否","arrow-end":"block-wide-long",symbols:{},flowstate:{}})},a.prototype._setTOC=function(e){return e.replace(/\[(TOC|MENU)]/g,'<blockquote class="markdown-contents"></blockquote>')},a.prototype._setImgResize=function(e){return e.replace(/<img(.*?)src="(.*?)=(\d*[-x×]\d*)(-[lrc])?"/g,function(e,t,n,o,r){var i="<img"+t+'src="'+n+'"',a=o.split(/[-x×]/),c={"-l":"left","-r":"right","-c":"center"}[r];return a[0]&&(i+=' width="'+a[0]+'"'),a[1]&&(i+=' height="'+a[1]+'"'),c&&(i+=' align="'+c+'"'),i})},a.prototype._setCheckbox=function(e){return e.replace(/\[([√×Xx\s\-_])\]\s(.*?)([<\n\r])/g,function(e,t,n,o,r){var i='<input type="checkbox" id="checkbox'+r+'"';return i+=/\s/.test(t)?">":'checked="true">',i+='<label for="checkbox'+r+'">'+n+"</label>",i+o})},a.prototype._setRedText=function(e){return e.replace(/==(.*?)==/g,function(e,t){return"<mark>"+t+"</mark>"})},a.prototype._createContents=function(e){var t=n(".markdown-contents").html(r(e));n("blockquote").each(function(){var e=n(this),o=e.find("ol>li>a");o.length>1&&(e.addClass("markdown-contents"),t=t.add(e))}),t.find("ol").each(function(){for(var e,t=n(this),o=t.children("li").children("a"),r=o.eq(0).text(),i=o.eq(1).text(),a=[/^[\(（]?(\d+\.?)+[^\d]{2,}/,/^[\(（【第]?[一二三四五六七八九十百千万壹贰叁肆伍陆柒捌玖拾佰仟]+/,/^(chapter)|(section)|(part)|(step)/i,/^[ⅠⅡⅢⅣIⅤⅥⅦⅧⅨⅩⅪⅫLCDM]+\.?/],c=0;e=a[c];c++)if(e.test(r)&&e.test(i)){t.addClass("unindex");break}});var o=function(e,t){0!=e.length&&e.children("li").each(function(r){var i=n(this);if(!e.hasClass("unindex")){var a="number"==typeof t?t+1+"."+(r+1):r+1+".";i.prepend("<i>"+a+"</i>")}o(i.children("ol"),r)})};t.children("ol").each(function(){o(n(this))})},a.prototype._encodeUrl=function(e,t){var n="library/";"string"==typeof AWConfig.libraryPrefix&&AWConfig.libraryPrefix.length>0&&(n=AWConfig.libraryPrefix.replace(/\\/g,"/").replace(/\/?&/,"/"));var o=[];return"normal"==t?"utf8"==localStorage[i]?n+=encodeURI(e):"gbk"==localStorage[i]&&(o=e.split("/").map(function(e){return GBK.encode(e)}),n+=o.join("/")):"reverse"==t&&("utf8"==localStorage[i]?(o=e.split("/").map(function(e){return GBK.encode(e)}),n+=o.join("/")):"gbk"==localStorage[i]&&(n+=encodeURI(e))),n+=".md?t="+(new Date).getTime()},a.prototype.renderDoc=function(e){var t=this,i="";this.cleanView(),e=e.replace(/\\(.)/g,function(e,t){return"&#"+t.charCodeAt(0)+";"}),e=this._setFootnote(e),i=r(e),i=this._setTOC(i),i=this._setImgResize(i),i=this._setCheckbox(i),i=this._setRedText(i),this.$e.view.html(i),this.$e.view.find("pre code").each(function(e,r){var i=n(r),a=i.attr("class")||"";a.indexOf("lang-flow")>=0?t._createFlowChart(i):a.indexOf("lang")>=0&&o.highlightBlock(r),a=i.attr("class")||"",a.indexOf("javascript")>=0&&t._setJSCommentDisable(i)});var a=this.$e.view.find("h1").eq(0).text();this.$e.title.text(a),this.$e.contentsTitle.text(a).attr("href","#"+a.replace(/"/g,""));var c=this._setTitlesAnchor();this._createContents(c)},a.prototype.getDoc=function(e,t){var o={type:"get",url:e,dataType:"text"};n.ajax(o).done(function(e){return/^\s*<!(DOCTYPE|doctype)/.test(e)?t("fail"):void t("done",e)}).fail(function(){t("fail")})},a.prototype.loadPage=function(e,t){var n=this,o=this._encodeUrl(e,"normal");this.getDoc(o,function(o,r){if("fail"==o){var a=n._encodeUrl(e,"reverse");n.getDoc(a,function(e){"fail"==e?t&&t("error"):"done"==e&&(localStorage[i]="utf8"==localStorage[i]?"gbk":"utf8",t&&t("success",r))})}else"done"==o&&t&&t("success",r)})},a.prototype.cleanView=function(){this.$e.view.find(".lang-off-js-comment").off("click"),this.$e.view.html("")},e.AWDocs=a}(window,document,jQuery);