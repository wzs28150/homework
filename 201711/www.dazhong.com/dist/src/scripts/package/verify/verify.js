/*! Verify-v0.1.0 MIT License by 大熊*/

!function(t,i,s,e){var o=function(i,s){this.$element=i,this.defaults={type:1,figure:100,arith:0,width:"200px",height:"60px",fontSize:"30px",codeLength:6,btnId:"check-btn",ready:function(){},success:function(){},error:function(){}},this.options=t.extend({},this.defaults,s)},h=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],n=["#fffff0","#f0ffff","#f0fff0","#fff0f0"],r=["#FF0033","#006699","#993366","#FF9900","#66CC66","#FF33CC"];o.prototype={init:function(){var t=this;this.loadDom(),this.setCode(),this.options.ready(),this.$element[0].onselectstart=s.body.ondrag=function(){return!1},this.$element.find(".verify-code, .verify-change-code").on("click",function(){t.setCode()}),this.htmlDoms.code_btn.on("click",function(){t.checkCode()})},loadDom:function(){var i='<div class="cerify-code-panel"><div class="verify-code-area"><div class="verify-input-area"><input type="text"class="varify-input-code"/></div><div class="verify-change-area"><a class="verify-change-code">换一张</a></div></div><div class="verify-code"></div></div>';this.$element.append(i),this.isEnd=!1,this.htmlDoms={code_btn:t("#"+this.options.btnId),code:this.$element.find(".verify-code"),code_area:this.$element.find(".verify-code-area"),code_input:this.$element.find(".varify-input-code")},this.htmlDoms.code.css({width:this.options.width,height:this.options.height,"line-height":this.options.height,"font-size":this.options.fontSize}),this.htmlDoms.code_area.css({width:this.options.width})},setCode:function(){if(0==this.isEnd){var t=Math.floor(3*Math.random()),i=Math.floor(5*Math.random());this.htmlDoms.code.css({"background-color":n[t],color:r[i]}),this.htmlDoms.code_input.val("");var s="";if(this.code_chose="",1==this.options.type)for(var e=0;e<this.options.codeLength;e++){var o=Math.floor(52*Math.random()),a=o%2==0?"font-style:italic;margin-right: 10px;":"font-weight:bolder;";a+=1==Math.floor(2*Math.random())?"font-weight:bolder;":"",this.code_chose+=h[o],s+='<font style="'+a+'">'+h[o]+"</font>"}else{var m=Math.floor(Math.random()*this.options.figure),c=Math.floor(Math.random()*this.options.figure);if(0==this.options.arith)var l=Math.floor(3*Math.random());switch(l){case 1:this.code_chose=parseInt(m)+parseInt(c),s=m+" + "+c+" = ?";break;case 2:if(parseInt(m)<parseInt(c)){var f=m;m=c,c=f}this.code_chose=parseInt(m)-parseInt(c),s=m+" - "+c+" = ?";break;default:this.code_chose=parseInt(m)*parseInt(c),s=m+" × "+c+" = ?"}}this.htmlDoms.code.html(s)}},checkCode:function(){if(1==this.options.type){var t=this.htmlDoms.code_input.val().toUpperCase();this.code_chose=this.code_chose.toUpperCase()}else var t=this.htmlDoms.code_input.val();t==this.code_chose?(this.isEnd=!0,this.options.success(this)):(this.options.error(this),this.setCode())},refresh:function(){this.isEnd=!1,this.$element.find(".verify-code").click()}};var a=function(i,s){this.$element=i,this.defaults={type:1,mode:"fixed",vOffset:5,vSpace:5,explain:"向右滑动完成验证",imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},blockSize:{width:"50px",height:"50px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=t.extend({},this.defaults,s)};a.prototype={init:function(){var t=this;this.loadDom(),this.options.ready(),this.$element[0].onselectstart=s.body.ondrag=function(){return!1},"pop"==this.options.mode&&(this.$element.on("mouseover",function(i){t.showImg()}),this.$element.on("mouseout",function(i){t.hideImg()}),this.htmlDoms.out_panel.on("mouseover",function(i){t.showImg()}),this.htmlDoms.out_panel.on("mouseout",function(i){t.hideImg()})),this.htmlDoms.move_block.on("touchstart",function(i){t.start(i)}),this.htmlDoms.move_block.on("mousedown",function(i){t.start(i)}),i.addEventListener("touchmove",function(i){t.move(i)}),i.addEventListener("mousemove",function(i){t.move(i)}),i.addEventListener("touchend",function(){t.end()}),i.addEventListener("mouseup",function(){t.end()}),t.$element.find(".verify-refresh").on("click",function(){t.refresh()})},loadDom:function(){this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var t="",i="";1!=this.options.type&&(t+='<div class="verify-img-out"><div class="verify-img-panel"><div  class="verify-refresh"><i class="iconfont icon-refresh"></i></div><div class="verify-gap"></div></div></div>',i='<div  class="verify-sub-block"></div>'),t+='<div class="verify-bar-area"><span  class="verify-msg">'+this.options.explain+'</span><div class="verify-left-bar"><span  class="verify-msg"></span><div  class="verify-move-block"><i  class="verify-icon iconfont icon-right"></i>'+i+"</div></div></div>",this.$element.append(t),this.htmlDoms={gap:this.$element.find(".verify-gap"),sub_block:this.$element.find(".verify-sub-block"),out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),move_block:this.$element.find(".verify-move-block"),left_bar:this.$element.find(".verify-left-bar"),msg:this.$element.find(".verify-msg"),icon:this.$element.find(".verify-icon"),refresh:this.$element.find(".verify-refresh")},this.status=!1,this.isEnd=!1,this.setSize=this.resetSize(this),this.$element.css("position","relative"),"pop"==this.options.mode?(this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}),this.htmlDoms.sub_block.css({display:"none"})):this.htmlDoms.out_panel.css({position:"relative"}),this.htmlDoms.gap.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.sub_block.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px"),this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.htmlDoms.bar_area.css({width:this.setSize.bar_width,height:this.options.barSize.height,"line-height":this.options.barSize.height}),this.htmlDoms.move_block.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.htmlDoms.left_bar.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.randSet()},start:function(t){0==this.isEnd&&(this.htmlDoms.msg.text(""),this.htmlDoms.move_block.css("background-color","#337ab7"),this.htmlDoms.left_bar.css("border-color","#337AB7"),this.htmlDoms.icon.css("color","#fff"),t.stopPropagation(),this.status=!0)},move:function(t){if(this.status&&0==this.isEnd){if("pop"==this.options.mode&&this.showImg(),t.touches)var i=t.touches[0].pageX;else var i=t.clientX;var s=a.prototype.getLeft(this.htmlDoms.bar_area[0]),e=i-s;1!=this.options.type?e>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2&&(e=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2):e>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3?(this.$element.find(".verify-msg:eq(1)").text("松开验证"),e=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3):this.$element.find(".verify-msg:eq(1)").text(""),e<=0&&(e=parseInt(parseInt(this.options.blockSize.width)/2)),this.htmlDoms.move_block.css("left",e-parseInt(parseInt(this.options.blockSize.width)/2)+"px"),this.htmlDoms.left_bar.css("width",e-parseInt(parseInt(this.options.blockSize.width)/2)+"px")}},end:function(){var t=this;if(this.status&&0==this.isEnd){if(1!=this.options.type){var i=parseInt(this.options.vOffset);parseInt(this.htmlDoms.gap.css("left"))>=parseInt(this.htmlDoms.move_block.css("left"))-i&&parseInt(this.htmlDoms.gap.css("left"))<=parseInt(this.htmlDoms.move_block.css("left"))+i?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({"border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.isEnd=!0,this.options.success(this)):(this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),setTimeout(function(){t.refresh()},400),this.options.error(this))}else parseInt(this.htmlDoms.move_block.css("left"))>=parseInt(this.setSize.bar_width)-parseInt(this.options.barSize.height)-parseInt(this.options.vOffset)?(this.htmlDoms.move_block.css("background-color","#5cb85c"),this.htmlDoms.left_bar.css({color:"#4cae4c","border-color":"#5cb85c","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-check"),this.htmlDoms.refresh.hide(),this.$element.find(".verify-msg:eq(1)").text("验证成功"),this.isEnd=!0,this.options.success(this)):(this.$element.find(".verify-msg:eq(1)").text(""),this.htmlDoms.move_block.css("background-color","#d9534f"),this.htmlDoms.left_bar.css("border-color","#d9534f"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("icon-right"),this.htmlDoms.icon.addClass("icon-close"),this.isEnd=!0,setTimeout(function(){t.$element.find(".verify-msg:eq(1)").text(""),t.refresh(),t.isEnd=!1},400),this.options.error(this));this.status=!1}},showImg:function(){this.htmlDoms.out_panel.css({display:"block"}),this.htmlDoms.sub_block.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"}),this.htmlDoms.sub_block.css({display:"none"})},resetSize:function(s){var e,o,h,n,r=s.$element.parent().width()||t(i).width(),a=s.$element.parent().height()||t(i).height();return e=s.options.imgSize.width.indexOf("%")!=-1?parseInt(s.options.imgSize.width)/100*r+"px":s.options.imgSize.width,o=s.options.imgSize.height.indexOf("%")!=-1?parseInt(s.options.imgSize.height)/100*a+"px":s.options.imgSize.height,h=s.options.barSize.width.indexOf("%")!=-1?parseInt(s.options.barSize.width)/100*r+"px":s.options.barSize.width,n=s.options.barSize.height.indexOf("%")!=-1?parseInt(s.options.barSize.height)/100*a+"px":s.options.barSize.height,{img_width:e,img_height:o,bar_width:h,bar_height:n}},randSet:function(){var t=Math.floor(9*Math.random()+1),i=Math.floor(9*Math.random()+1),s=t*parseInt(this.setSize.img_height)/15+.1*parseInt(this.setSize.img_height),e=i*parseInt(this.setSize.img_width)/15+.1*parseInt(this.setSize.img_width);this.$element.find(".verify-gap").css({top:s,left:e}),this.$element.find(".verify-sub-block").css({top:"-"+(parseInt(this.setSize.img_height)-s+this.options.vSpace)+"px","background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height,"background-position-y":"-"+s+"px","background-position-x":"-"+e+"px"})},refresh:function(){this.htmlDoms.refresh.show(),this.$element.find(".verify-msg:eq(1)").text(""),this.$element.find(".verify-msg:eq(1)").css("color","#000"),this.htmlDoms.move_block.animate({left:"0px"},"fast"),this.htmlDoms.left_bar.animate({width:"40px"},"fast"),this.htmlDoms.left_bar.css({"border-color":"#ddd"}),this.htmlDoms.move_block.css("background-color","#fff"),this.htmlDoms.icon.css("color","#000"),this.htmlDoms.icon.removeClass("icon-close"),this.htmlDoms.icon.addClass("icon-right"),this.$element.find(".verify-msg:eq(0)").text(this.options.explain),this.randSet(),this.img_rand=Math.floor(Math.random()*this.options.imgName.length),this.$element.find(".verify-img-panel").css({background:"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.$element.find(".verify-sub-block").css({"background-image":"url("+this.options.imgUrl+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.isEnd=!1},getLeft:function(i){var s=t(i).offset().left;return s}};var m=function(i,s){this.$element=i,this.defaults={mode:"fixed",defaultNum:4,checkNum:3,vSpace:5,imgUrl:"images/",imgName:["1.jpg","2.jpg"],imgSize:{width:"400px",height:"200px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=t.extend({},this.defaults,s)};m.prototype={init:function(){var t=this;t.loadDom(),t.refresh(),t.options.ready(),this.$element[0].onselectstart=s.body.ondrag=function(){return!1},"pop"==this.options.mode&&(this.$element.on("mouseover",function(i){t.showImg()}),this.$element.on("mouseout",function(i){t.hideImg()}),this.htmlDoms.out_panel.on("mouseover",function(i){t.showImg()}),this.htmlDoms.out_panel.on("mouseout",function(i){t.hideImg()})),t.$element.find(".verify-img-panel canvas").on("click",function(i){t.checkPosArr.push(t.getMousePos(this,i)),t.num==t.options.checkNum&&(t.num=t.createPoint(t.getMousePos(this,i)),setTimeout(function(){var i=t.comparePos(t.fontPos,t.checkPosArr);0==i?(t.options.error(t),t.$element.find(".verify-bar-area").css({color:"#d9534f","border-color":"#d9534f"}),t.$element.find(".verify-msg").text("验证失败"),setTimeout(function(){t.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"}),t.refresh()},400)):(t.$element.find(".verify-bar-area").css({color:"#4cae4c","border-color":"#5cb85c"}),t.$element.find(".verify-msg").text("验证成功"),t.$element.find(".verify-refresh").hide(),t.$element.find(".verify-img-panel").unbind("click"),t.options.success(t))},400)),t.num<t.options.checkNum&&(t.num=t.createPoint(t.getMousePos(this,i)))}),t.$element.find(".verify-refresh").on("click",function(){t.refresh()})},loadDom:function(){this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var t="";this.setSize=a.prototype.resetSize(this),t+='<div class="verify-img-out"><div class="verify-img-panel"><div class="verify-refresh" style="z-index:3"><i class="iconfont icon-refresh"></i></div><canvas width="'+this.setSize.img_width+'" height="'+this.setSize.img_height+'"></canvas></div></div><div class="verify-bar-area"><span  class="verify-msg"></span></div>',this.$element.append(t),this.htmlDoms={out_panel:this.$element.find(".verify-img-out"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),msg:this.$element.find(".verify-msg")},this.$element.css("position","relative"),"pop"==this.options.mode?this.htmlDoms.out_panel.css({display:"none",position:"absolute",bottom:"42px"}):this.htmlDoms.out_panel.css({position:"relative"}),this.htmlDoms.out_panel.css("height",parseInt(this.setSize.img_height)+this.options.vSpace+"px"),this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,"background-size":this.setSize.img_width+" "+this.setSize.img_height,"margin-bottom":this.options.vSpace+"px"}),this.htmlDoms.bar_area.css({width:this.options.barSize.width,height:this.options.barSize.height,"line-height":this.options.barSize.height})},drawImg:function(t,i){var s=this.$element.find("canvas")[0],e=s.getContext("2d");e.drawImage(i,0,0,parseInt(this.setSize.img_width),parseInt(this.setSize.img_height));for(var o=["italic small-caps bold 20px microsoft yahei","small-caps normal 25px arial","34px microsoft yahei"],h="天地玄黄宇宙洪荒日月盈昃辰宿列张寒来暑往秋收冬藏闰余成岁律吕调阳云腾致雨露结为霜金生丽水玉出昆冈剑号巨阙珠称夜光果珍李柰菜重芥姜海咸河淡鳞潜羽翔龙师火帝鸟官人皇始制文字乃服衣裳推位让国有虞陶唐吊民伐罪周发殷汤坐朝问道垂拱平章爱育黎首臣伏戎羌遐迩体率宾归王",n=[],a=Math.floor(parseInt(this.setSize.img_width)/(parseInt(this.options.defaultNum)+1)),m="",c=Math.floor(5*Math.random()),l=1;l<=this.options.defaultNum;l++){if(n[l-1]=this.getChars(h,n),m=Math.floor(3*Math.random()),e.font=o[m],e.fillStyle=r[c],1==Math.floor(2*Math.random()))var f=Math.floor(parseInt(this.setSize.img_height)/2)+20*m+20;else var f=Math.floor(parseInt(this.setSize.img_height)/2)-20*m;e.fillText(n[l-1],a*l,f),this.fontPos[l-1]={char:n[l-1],x:a*l,y:f}}for(var l=0;l<this.options.defaultNum-this.options.checkNum;l++)this.shuffle(this.fontPos).pop();for(var d="",l=0;l<this.fontPos.length;l++)d+=this.fontPos[l].char+",";return this.htmlDoms.msg.text("请顺序点击【"+d.substring(0,d.length-1)+"】"),this.fontPos},getMousePos:function(e,o){var h=o||i.event,n=(s.documentElement.scrollLeft||s.body.scrollLeft,s.documentElement.scrollTop||s.body.scrollTop,h.clientX-(t(e).offset().left-t(i).scrollLeft())),r=h.clientY-(t(e).offset().top-t(i).scrollTop());return{x:n,y:r}},getChars:function(i,s){var e=parseInt(Math.floor(Math.random()*i.length));return e>0&&(e-=1),tmp_char=i.charAt(e),t.inArray(tmp_char,s)==-1?tmp_char:m.prototype.getChars(i,s)},shuffle:function(t){for(var i,s,e=t.length;e;)i=Math.random()*e-->>>0,s=t[e],t[e]=t[i],t[i]=s;return t},createPoint:function(t){return this.htmlDoms.img_panel.append('<div class="point-area" style="background-color:#1abd6c;color:#fff;z-index:9999;width:30px;height:30px;text-align:center;line-height:30px;border-radius: 50%;position:absolute;top:'+parseInt(t.y-10)+"px;left:"+parseInt(t.x-10)+'px;">'+this.num+"</div>"),++this.num},comparePos:function(t,i){for(var s=!0,e=0;e<t.length;e++)if(!(parseInt(i[e].x)+40>t[e].x&&parseInt(i[e].x)-40<t[e].x&&parseInt(i[e].y)+40>t[e].y&&parseInt(i[e].y)-40<t[e].y)){s=!1;break}return s},showImg:function(){this.htmlDoms.out_panel.css({display:"block"})},hideImg:function(){this.htmlDoms.out_panel.css({display:"none"})},refresh:function(){var i=this;this.$element.find(".point-area").remove(),this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var s=new Image;s.src=this.options.imgUrl+this.options.imgName[this.img_rand],t(s).on("load",function(t){this.fontPos=i.drawImg(i,this)}),i.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"}),i.$element.find(".verify-msg").text("验证失败"),i.$element.find(".verify-refresh").show()}},t.fn.codeVerify=function(t,i){var s=new o(this,t);s.init()},t.fn.slideVerify=function(t,i){var s=new a(this,t);s.init()},t.fn.pointsVerify=function(t,i){var s=new m(this,t);s.init()}}(jQuery,window,document);