$(function(){function e(){$(".model_bg").fadeOut(300),$(".my_model").fadeOut(300),$("header").removeClass("on")}function s(e){var s=0,t=0,e=0,a=0,i=0,n=$(".calBtn a");c.each(function(){if($(this).is(":checked")){var e=parseFloat($(this).parents(".order_lists").find(".sum_price").html().substring(1)),a=parseFloat($(this).parents(".order_lists").find(".sum").val());s+=e,t+=a}}),e=.5*Math.floor(parseInt($("#totaljf").html())/100),$("#syjf").html("￥"+e),e=$("#jifen").is(":checked")?parseFloat($("#syjf").html().substring(1)):0,$("#cpje").html("￥"+s),$(".piece_num").html(t),a=parseFloat($("#cxyh").html().substring(1)),i=parseFloat($("#ygyf").html().substring(1));var l=s-e-a+i;$(".total_text").html("￥"+l),0!=s&&0!=t?n.hasClass("btn_sty")||(n.addClass("btn_sty"),n.click(function(e){$(".form1").submit()})):n.hasClass("btn_sty")&&n.removeClass("btn_sty")}var t=$('input[type="checkbox"]'),a=$(".whole_check"),i=$(".cartBox"),n=$(".shopChoice"),c=$(".son_check");t.click(function(){$(this).is(":checked")?$(this).next("label").addClass("mark"):$(this).next("label").removeClass("mark")}),a.click(function(){var e=i.find('input[type="checkbox"]');$(this).is(":checked")?(e.prop("checked",!0),e.next("label").addClass("mark")):(e.prop("checked",!1),e.next("label").removeClass("mark")),s()}),c.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=c.length,s=0;c.each(function(){$(this).is(":checked")&&s++}),s==e&&(a.prop("checked",!0),a.next("label").addClass("mark"))}else a.prop("checked",!1),a.next("label").removeClass("mark")})}),n.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=n.length,t=0;n.each(function(){$(this).is(":checked")&&t++}),t==e&&(a.prop("checked",!0),a.next("label").addClass("mark")),$(this).parents(".cartBox").find(".son_check").prop("checked",!0),$(this).parents(".cartBox").find(".son_check").next("label").addClass("mark")}else a.prop("checked",!1),a.next("label").removeClass("mark"),$(this).parents(".cartBox").find(".son_check").prop("checked",!1),$(this).parents(".cartBox").find(".son_check").next("label").removeClass("mark");s()})}),i.each(function(){var e=$(this),t=e.find(".son_check");t.each(function(){$(this).click(function(){if($(this).is(":checked")){var e=t.length,a=0;t.each(function(){$(this).is(":checked")&&a++}),a==e&&($(this).parents(".cartBox").find(".shopChoice").prop("checked",!0),$(this).parents(".cartBox").find(".shopChoice").next("label").addClass("mark"))}else $(this).parents(".cartBox").find(".shopChoice").prop("checked",!1),$(this).parents(".cartBox").find(".shopChoice").next("label").removeClass("mark");s()})})});var l=$(".plus"),r=$(".reduce"),h=$(".sum");l.click(function(){var e=$(this).prev("input"),t=parseInt(e.val())+1,a=$(this).parents(".amount_box").find(".reduce"),i=$(this).parents(".order_lists").find(".sum_price"),n=$(this).parents(".order_lists").find(".price").html(),c=t*parseInt(n.substring(1));e.val(t),i.html("￥"+c),e.val()>1&&a.hasClass("reSty")&&a.removeClass("reSty"),s()}),r.click(function(){var e=$(this).next("input"),t=parseInt(e.val())-1,a=$(this).parents(".order_lists").find(".sum_price"),i=$(this).parents(".order_lists").find(".price").html(),n=t*parseInt(i.substring(1));e.val()>1&&(e.val(t),a.html("￥"+n)),1!=e.val()||$(this).hasClass("reSty")||$(this).addClass("reSty"),s()}),h.keyup(function(){var e=0,t=$(this).parents(".order_lists").find(".sum_price"),a=$(this).parents(".order_lists").find(".price").html(),i=0;""==$(this).val()&&$(this).val("1"),$(this).val($(this).val().replace(/\D|^0/g,"")),e=$(this).val(),i=e*parseInt(a.substring(1)),$(this).attr("value",e),t.html("￥"+i),s()});var o=null,d="";$(".delBtn").click(function(){o=$(this).parents(".order_lists"),d=o.parents(".order_content"),$("header").addClass("on"),$(".model_bg").fadeIn(300),$(".my_model").fadeIn(300)}),$(".delallBtn").click(function(){$(".dialog-sure").addClass("all"),$("header").addClass("on"),$(".model_bg").fadeIn(300),$(".my_model").fadeIn(300)}),$(".closeModel").click(function(){e()}),$(".dialog-close").click(function(){e()}),$(".dialog-sure").click(function(){$(this).hasClass("all")?$(".son_check").each(function(e,s){if($(this).is(":checked")){var t=$(this).parents(".order_lists"),a=t.parents(".order_content");t.remove(),null!=a.html().trim()&&0!=a.html().trim().length||a.parents(".cartBox").remove()}}):(o.remove(),null!=d.html().trim()&&0!=d.html().trim().length||d.parents(".cartBox").remove()),e(),$(this).removeClass("all"),c=$(".son_check"),s()}),$(".dojifen").click(function(e){$(".son_check:checked").length>0&&setTimeout(function(){s()},10)})});